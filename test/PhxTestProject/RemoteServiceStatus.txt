using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Management.Automation;
using System.Management.Automation.Runspaces;
using System.ServiceProcess;

namespace ConsoleApplication1
{
    class Program
    {
       
        static void Main(string[] args)
        {
            Console.WriteLine(IsServiceInstalled("W3SVC"));
            Console.WriteLine(IsRemoteServiceInstalled("W3SVC", "khphoenixsql2"));
            Console.WriteLine(IsRemoteServiceInstalled("W3SVC", "khphoenixsql5"));
            Console.WriteLine(RemoteServiceStatus("Joe", "khphoenixsql2"));
            Console.WriteLine(RemoteServiceStatus("smphost", "khphoenixsql2"));
            Console.WriteLine(RemoteServiceStatus("W3SVC", "khphoenixsql2"));
            Console.WriteLine(RemoteServiceStatus("Joe", "khphoenixsql5"));
            Console.WriteLine(RemoteServiceStatus("smphost", "khphoenixsql5"));
            Console.WriteLine(RemoteServiceStatus("W3SVC", "khphoenixsql5"));
            Console.ReadKey();

        }

        // This function returns a boolean indicating if the service is running on the localmachine
        public static bool IsServiceInstalled(string serviceName)
        {
            // get list of Windows services
            ServiceController[] services = ServiceController.GetServices();

            // try to find service name
            foreach (ServiceController service in services)
            {
                if (service.ServiceName == serviceName)
                    return true;
            }
            return false;
        }

        //this function returns a boolean indiciating if the service is running on a remote machine
        public static bool IsRemoteServiceInstalled(string serviceName, string serverName)
        {
            //had to add the try statement for if the server did not exist, or could not be reached.
            try
            {
                // get list of Windows services
                ServiceController[] services = ServiceController.GetServices(serverName);

                // try to find service name
                foreach (ServiceController service in services)
                {
                    if (service.ServiceName == serviceName)
                        return true;
                }
            }
            catch
            {
                return false;
            }
            return false;
        }

        public static string RemoteServiceStatus(string serviceName, string serverName)
        {
            try
            {
                // get list of Windows services on the remote machine
                ServiceController[] services = ServiceController.GetServices(serverName);

                // try to find service name in the list of services
                foreach (ServiceController service in services)
                {
                    if (service.ServiceName == serviceName)
                    {
                        if (service.Status.ToString() == "Running")
                        {
                            // return this if it is installed and running
                            return serviceName + ": Installed on " + serverName + ", Status: Running";
                        }
                        else
                        {
                            // return this if it is installed but in some other state
                            return serviceName + ": Installed on " + serverName + ", Status: " + service.Status.ToString();
                        }
                    }
                }
            }
            catch
            {
                // return this is an exception occurs because the server cannot be accessed or found
                return "Cannot access or find the server: " + serverName;
            }
            // if the server can be connected to but the service isn't installed it will reach this point
            return serviceName + ": NOT installed on " + serverName + ".";
        }


    }
}