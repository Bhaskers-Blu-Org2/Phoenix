using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Microsoft.Web.Administration;

namespace ConsoleApplication3
{
    class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine(ReadSiteDataLocally());

            Console.ReadKey();
        }

        static string ReadSiteDataLocally()
        {
            ServerManager IIS = new ServerManager();
            string output = "";

            foreach (Site site in IIS.Sites)
            {
                output += site.Name + " , ";
                //output+= site.Id + " , ";
                output += site.State + " , ";
                foreach (Binding bindingElement in site.Bindings)
                {
                    output += bindingElement.Protocol + " , ";
                    string parseport = bindingElement.EndPoint + "";
                    int portpos = parseport.IndexOf(":");
                    output += parseport.Substring(portpos + 1) + " , ";
                }
                output += site.Applications["/"].VirtualDirectories[0].PhysicalPath + "\r\n";
            }
            return output;
        }

        static string ReadSiteDataRemotely(string serverName)
        {
            ServerManager IIS = new ServerManager();
            string output = "";

            foreach (Site site in IIS.Sites)
            {
                output += site.Name + " , ";
                //output+= site.Id + " , ";
                output += site.State + " , ";
                foreach (Binding bindingElement in site.Bindings)
                {
                    output += bindingElement.Protocol + " , ";
                    string parseport = bindingElement.EndPoint + "";
                    int portpos = parseport.IndexOf(":");
                    output += parseport.Substring(portpos + 1) + " , ";
                }
                output += site.Applications["/"].VirtualDirectories[0].PhysicalPath + "\r\n";
            }
            return output;
        }


    }
}